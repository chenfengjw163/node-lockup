# node-lockup

## ä»‹ç»

nodeç«¯çš„ç®€å•å¼‚æ­¥é”ï¼Œnodeæ²¡æœ‰çº¿ç¨‹æ¦‚å¿µå¹¶ä¸”å¤„ç†è¯·æ±‚æ—¶æ‰€æœ‰IOæ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œåœ¨éƒ¨åˆ†åœºæ™¯ä¸‹æˆ‘ä»¬éœ€è¦è®©è¿™äº›IOæ“ä½œæ’é˜Ÿæ‰§è¡Œã€‚

ç±»ä¼¼äºC#ä¸­çš„lockå’Œjavaä¸­çš„sychronizedçš„å¯¹è±¡é”ï¼Œ`node-lockup`çš„å®ç°æ–¹å¼æ˜¯åˆ©ç”¨æ•°ç»„å®ç°ä¸€ä¸ªç®€å•çš„é˜Ÿåˆ—ï¼Œé€šè¿‡ç”¨æˆ·è°ƒç”¨è§¦å‘æ’é˜Ÿè‡ªæ‰§è¡Œã€‚

æ‰€æœ‰è¯·æ±‚æ’é˜Ÿæ‰§è¡Œï¼Œæ‰§è¡Œé€Ÿåº¦å–å†³äºtaskå‡½æ•°æ‰§è¡Œé€Ÿåº¦ï¼Œé¢å¯¹é«˜å¹¶å‘è¯·æ±‚æ—¶ä¼šäº§ç”Ÿå¤§é‡è¯·æ±‚ç­‰å¾…ï¼Œè°¨æ…ä½¿ç”¨ã€‚

## ç¤ºä¾‹


``` javascript
const lockup = require('node-lockup')

const task = (params) => { // éœ€è¦æ’é˜Ÿæ‰§è¡Œçš„å¼‚æ­¥å‡½æ•°
  return new Promise((resolve, reject) => {
    /// some I/O operating
    resolve(data) 
  })
}

const lockTask = lockup(task) // åˆ›å»ºæ’é˜Ÿæ‰§è¡Œå‡½æ•°
//const lockTask = lockup(task, 100) // åˆ›å»ºæ’é˜Ÿæ‰§è¡Œå‡½æ•°ï¼Œé—´éš”100msæ‰§è¡Œ

module.exports = async (req, res, next) => {
  const result = await lockTask(params) //æ‰€æœ‰è¯·æ±‚æ’é˜Ÿæ‰§è¡Œï¼Œæ‰§è¡Œé€Ÿåº¦å–å†³äºtaskå‡½æ•°æ‰§è¡Œé€Ÿåº¦
  /// other code
}
```

æ³¨æ„ï¼š lockupæ¥å—ä¸€ä¸ªè¿”å›Promiseå¯¹è±¡çš„å‡½æ•°å‚æ•°